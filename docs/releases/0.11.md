# Koheesio 0.11

Version 0.11 is Koheesio's 5th release since getting Open Sourced.

This version brings important bug fixes and improvements to the core Context module. The overall API remains unchanged.

## Migrating from v0.10

For users currently using v0.10, no breaking changes have been introduced. This release focuses on bug fixes and stability improvements.

## Release 0.11.0

**v0.11.0** - *TBD*

* **Full Changelog**:
    <https://github.com/Nike-Inc/koheesio/compare/koheesio-v0.10.6...koheesio-v0.11.0>

### Bugfixes

!!! bug "bugfix - PR [#TBD](https://github.com/Nike-Inc/koheesio/pull/TBD), related issue [#226](https://github.com/Nike-Inc/koheesio/issues/226)"
    #### *Core > Context*: Handle Path objects gracefully in `Context.from_yaml()`

    Fixed a bug where `Context.from_yaml()` would raise a confusing `AttributeError: 'PosixPath' object has no attribute 'read'` when passed a `pathlib.Path` object pointing to a non-existent file.

    **Root Cause:**  
    When a Path object for a non-existent file was passed to `from_yaml()`, the method would skip reading the file (since it doesn't exist), but would then pass the Path object directly to `yaml.load()`. The YAML parser tried to call `.read()` on the Path object, causing an AttributeError.

    **Fix:**  
    Added an `else` clause to convert Path objects to strings when the file doesn't exist, matching the existing pattern used in `Context.from_toml()`. This prevents the AttributeError and allows the YAML parser to handle the stringified path appropriately.

    **Impact:**  
    This bug was commonly encountered where configuration files might be missing due to environment misconfiguration. The error message was confusing and didn't clearly indicate that a file was missing. Now, the error handling is more graceful and consistent with the `from_toml()` method.

    **Test Coverage:**  
    Added comprehensive test (`test_from_yaml_path_object_nonexistent_file`) to verify the fix and prevent regression.

    <small> by @dannymeijer </small>


### Features

!!! feature "enhancement - PR [#239](https://github.com/Nike-Inc/koheesio/pull/239)"
    #### *Core > Models*: New NestedEnum utility for case-insensitive nested enums
    
    Added a new `NestedEnum` utility to `koheesio.models` enabling clean, case-insensitive
    nested enum structures. Both metaclass and decorator syntax supported.
    
    **Key Features:**
    - Case-insensitive access: `OutputMode.BATCH.APPEND`, `OutputMode.batch.APPEND`, `OutputMode.Batch.APPEND` all work
    - One-time normalization at class creation (no runtime overhead)
    - Collision detection prevents duplicate nested classes with different casing
    - Compatible with Pydantic models and Python's `enum.Enum`
    
    **Usage:**
    ```python
    from koheesio.models import nested_enum
    from enum import Enum
    
    @nested_enum
    class OutputMode:
        class BATCH(str, Enum):
            APPEND = "append"
            OVERWRITE = "overwrite"
        
        class STREAMING(str, Enum):
            APPEND = "append"
            COMPLETE = "complete"
    
    # All case variations work:
    mode = OutputMode.BATCH.APPEND
    mode = OutputMode.batch.APPEND  # Also works!
    mode = OutputMode.Batch.OVERWRITE  # Also works!
    ```
    
    **Refactored OutputMode enums:**
    - New nested structure: `OutputMode.BATCH.*` and `OutputMode.STREAMING.*`
    - Backward compatibility aliases: `BatchOutputMode` and `StreamingOutputMode` still work
    - No breaking changes to existing code
    - All existing writer tests pass
    
    **Implementation Details:**
    - Uses a custom metaclass (`NestedEnumMeta`) that normalizes nested class names to uppercase at class creation time
    - Provides case-insensitive access by trying normalized (uppercase) lookup first, then exact match
    - Simple, clean implementation with minimal overhead
    
    <small> by @dannymeijer </small>
    
!!! bug "bugfix - PR [#237](https://github.com/Nike-Inc/koheesio/pull/237), related issue [#236](https://github.com/Nike-Inc/koheesio/issues/236)"
    #### *Build/CI*: Fix PEP 503 normalization for optional dependencies
    
    Fixed GitHub Actions test failures caused by Hatch 1.16.1's stricter enforcement of PEP 503 package name normalization.
    
    **Root Cause:**  
    Hatch 1.16.1 (used in GitHub Actions) enforces PEP 503 normalization which converts underscores to hyphens in package extra names. The `async_http` optional dependency in `pyproject.toml` was being normalized to `async-http` when Hatch validated the features list, but the definition still used `async_http`, causing a mismatch.
    
    **Fix:**  
    - Renamed `async_http` to `async-http` in `[project.optional-dependencies]` to match PEP 503 normalization
    - Added `make hatch-upgrade` command to help developers keep their Hatch version aligned with CI
    - Added delta-spark version constraints per PySpark version to prevent incompatibility issues
    
    **Impact:**  
    All GitHub Actions test workflows were failing across all Python and PySpark version combinations. This prevented any PRs from being merged. The fix aligns with Python packaging standards and ensures local development environments can match CI behavior.
    
    <small> by @dannymeijer </small>

